<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Dostawca</title>
    <style>
        :root { --primary: #D32F2F; --nav: #1A237E; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f6f8; margin: 0; padding: 20px; color: #333; }
        .header { background: white; padding: 15px 30px; border-bottom: 2px solid var(--primary); display: flex; justify-content: space-between; margin-bottom: 30px; }
        .card { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .auction-grid { display: grid; grid-template-columns: 1fr 1fr 300px; gap: 40px; }
        .section-title { font-weight: bold; color: var(--nav); border-bottom: 2px solid #eee; padding-bottom: 5px; margin-bottom: 15px; }
        .detail-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .detail-label { font-weight: bold; color: #555; }
        .timer-box { text-align: center; background: #fafafa; border: 1px solid #eee; padding: 20px; border-radius: 8px; }
        .timer-time { font-size: 24px; font-weight: bold; color: var(--primary); margin: 10px 0; }
        input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #eee; }
    </style>
    <script>
        function startTimer(deadline, elementId) {
            var countDownDate = new Date(deadline).getTime();
            var x = setInterval(function() {
                var now = new Date().getTime();
                var distance = countDownDate - now;
                if (distance < 0) {
                    clearInterval(x);
                    document.getElementById(elementId).innerHTML = "ZAKOÅƒCZONA";
                    return;
                }
                var d = Math.floor(distance / (1000 * 60 * 60 * 24));
                var h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                var m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById(elementId).innerHTML = d + "d " + h + "h " + m + "m";
            }, 1000);
        }
    </script>
</head>
<body>

<div class="header">
    <div style="font-size:24px; font-weight:900; color:var(--primary);">NECKS <span>PORTAL</span></div>
    <div>{{ session['user'] }} <a href="/logout" style="color:#777; margin-left:10px;">Wyloguj</a></div>
</div>

{% for ex in exchange_data %}
<form action="/save_offer/{{ ex.id }}" method="post">
    <div class="card">
        <div style="display:flex; justify-content:space-between; border-bottom:1px solid #eee; padding-bottom:15px; margin-bottom:20px;">
            <h1 style="margin:0;">{{ ex.name }}</h1>
            <span style="background:#2e7d32; color:white; padding:5px 15px; border-radius:20px; font-size:12px; font-weight:bold;">AKTYWNA</span>
        </div>

        <div class="auction-grid">
            <div>
                <div class="section-title">SzczegÃ³Å‚y Zlecenia</div>
                <p>{{ ex.desc }}</p>
                {% if ex.f1 %}<a href="/static/uploads/{{ ex.f1 }}" target="_blank">ðŸ“„ Packing List</a>{% endif %}
                {% if ex.f2 %}<a href="/static/uploads/{{ ex.f2 }}" target="_blank">ðŸ“Ž Inne</a>{% endif %}
            </div>

            <div>
                <div class="section-title">Trasa i Warunki</div>
                <div class="detail-row"><span class="detail-label">Incoterms:</span> <span>{{ ex.incoterms }}</span></div>
                <div class="detail-row"><span class="detail-label">Port ZaÅ‚adunku:</span> <span>{{ ex.port }}</span></div>
                <div class="detail-row"><span class="detail-label">Termin Odbioru:</span> <span>{{ ex.pickup }}</span></div>
                {% if ex.cat == 'Spedycja' %}
                    {% for m in ex.mats %}
                    <div style="border-top:1px solid #eee; margin-top:5px; padding-top:5px;">
                        <div class="detail-row"><span class="detail-label">Towar:</span> <span>{{ m.name }}</span></div>
                        <div class="detail-row"><span class="detail-label">Waga:</span> <span>{{ m.net }} kg</span></div>
                        <div class="detail-row"><span class="detail-label">HS Code:</span> <span>{{ m.hs }}</span></div>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>

            <div class="timer-box">
                <div style="font-size:30px;">ðŸ•’</div>
                <div>PozostaÅ‚o czasu:</div>
                <div id="timer-{{ ex.id }}" class="timer-time">...</div>
                <script>startTimer("{{ ex.deadline }}", "timer-{{ ex.id }}");</script>
                <div style="font-size:12px; color:#777; margin-top:5px;">Do: {{ ex.deadline.replace('T', ' ') }}</div>
            </div>
        </div>

        <div style="background:#e3f2fd; padding:20px; border-radius:8px; margin-top:20px;">
            <div class="section-title">Twoja Oferta</div>
            
            {% if ex.cat == 'Spedycja' %}
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:20px;">
                    <div><label>PLN</label><input type="text" name="sp_pln" value="{{ ex.shipping_bid[0] if ex.shipping_bid else '' }}"></div>
                    <div><label>EUR</label><input type="text" name="sp_eur" value="{{ ex.shipping_bid[1] if ex.shipping_bid else '' }}"></div>
                    <div><label>USD</label><input type="text" name="sp_usd" value="{{ ex.shipping_bid[2] if ex.shipping_bid else '' }}"></div>
                </div>
                <div style="text-align:right; margin-top:10px;">
                    TwÃ³j Ranking: <strong style="color:blue; font-size:18px;">{{ ex.shipping_rank }}</strong>
                </div>
            {% else %}
                <table>
                    <tr><th>Nazwa</th><th>HS Code</th><th>IloÅ›Ä‡</th><th>Cena (PLN)</th><th>Twoja Pozycja</th></tr>
                    {% for m in ex.mats %}
                    <tr>
                        <td>{{ m.name }}</td>
                        <td>{{ m.hs }}</td>
                        <td>{{ m.qty }}</td>
                        <td><input type="text" name="price_{{ m.id }}" value="{{ m.saved[0] if m.saved else '' }}"></td>
                        <td style="font-weight:bold; color:blue;">{{ m.rank }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% endif %}
            
            <button class="btn">ZatwierdÅº OfertÄ™</button>
        </div>
    </div>
</form>
{% endfor %}

</body>
</html>
